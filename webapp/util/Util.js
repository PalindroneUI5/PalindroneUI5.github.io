/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ui.core.util.Export");jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");jQuery.sap.require("jquery.sap.resources");jQuery.sap.require("testnamespace.util.Formatter");jQuery.sap.declare("testnamespace.util.Util");testnamespace.util.Util={C_CSV_SYSTEM_NOTE_STAT:"SysRec_Systems",C_CSV_SYSTEM_NOTE:"SysRec_Notes",C_CSV_NOTE_OBJECT:"SysRec_Object_List",C_CSV_NOTE_REQ_NOTE:"SysRec_Prerequsite_Notes",C_CSV_CHARM:"SysRec_Requests_for_Change",C_CSV_BPCA:"SysRec_Change_Impact_Analysis",getResourceBundle:function(){if(!testnamespace.util.Util._bundle){var l=sap.ui.getCore().getConfiguration().getLanguage();var p=jQuery.sap.getModulePath("testnamespace");var u=p+"/i18n/i18n.properties";testnamespace.util.Util._bundle=jQuery.sap.resources({url:u,locale:l});}return testnamespace.util.Util._bundle;},exportSystemData:function(e,p){var m=e.getModel();var b=e.getBinding("items");var a=testnamespace.util.Util.getResourceBundle();var P="/SystemStatisticsSet";if(p){P=p+P;}if(typeof b.sFilterParams!=="undefined"){P=P+"?"+b.sFilterParams;if(typeof b.sSortParams!=="undefined"){P=P+"&"+b.sSortParams;}}else{if(typeof b.sSortParams!=="undefined"){P=P+"?"+b.sSortParams;}}m.read(P,null,null,true,function(d){var c=new sap.ui.model.json.JSONModel();c.setData(d.results);var E=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:a.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:a.getText("FILTER_IT_ROLE"),template:{content:"{ path: 'SystemRole', formatter: 'testnamespace.util.Formatter.getSystemRoleText' }"}},{name:a.getText("FILTER_PRIORITY"),template:{content:"{ path: 'SystemPriority', formatter: 'testnamespace.util.Formatter.getSystemPriorityText' }"}},{name:a.getText("SAP_NOTE_TYPE_SECURITY"),template:{content:"{SecurityCount}"}},{name:a.getText("SAP_NOTE_TYPE_HOTNEWS"),template:{content:"{HotnewsCount}"}},{name:a.getText("SAP_NOTE_TYPE_PERFORMANCE"),template:{content:"{PerformanceCount}"}},{name:a.getText("SAP_NOTE_TYPE_LEGAL"),template:{content:"{LegalCount}"}},{name:a.getText("SAP_NOTE_FAVORITE"),template:{content:"{IsFavorite}"}}]});var f=testnamespace.util.Util.C_CSV_SYSTEM_NOTE_STAT+"-"+testnamespace.util.Util.getCurrentDateTime();E.setModel(c);E.bindRows("/");E.saveFile(f).always(function(){this.destroy();});});},getCurrentDateTime:function(){var d=new Date();var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd_hh-mm-ss"});return a.format(d,true);},exportObjectListPopup:function(m,p){var b=testnamespace.util.Util.getResourceBundle();var P="/SystemNoteObjectSet";if(p){P=p+P;}var e=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),models:m,rows:{path:P},columns:[{name:b.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:b.getText("NOTE_NUMBER"),template:{content:"{NoteNumber}"}},{name:b.getText("PROGRAM_ID"),template:{content:"{ProgramId}"}},{name:b.getText("OBJECT_TYPE"),template:{content:"{ObjectType}"}},{name:b.getText("OBJECT_NAME"),template:{content:"{ObjectName}"}},{name:b.getText("PROGRAM_ID2"),template:{content:"{ProgramId2}"}},{name:b.getText("OBJECT_TYPE2"),template:{content:"{ObjectType2}"}},{name:b.getText("OBJECT_NAME2"),template:{content:"{ObjectName2}"}}]});var f=testnamespace.util.Util.C_CSV_NOTE_OBJECT+" "+testnamespace.util.Util.getCurrentDateTime();e.saveFile(f).always(function(){this.destroy();});},exportRequiredNotePopup:function(m,p){var b=testnamespace.util.Util.getResourceBundle();var P="/SystemNoteRequiredNoteSet";if(p){P=p+P;}var e=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),models:m,rows:{path:P},columns:[{name:b.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:b.getText("NOTE_NUMBER"),template:{content:"{NoteNumber}"}},{name:b.getText("NOTE_NUMBER_REQ"),template:{content:"{NoteNumberReq}"}},{name:b.getText("NOTE_TEXT"),template:{content:"{ShortText}"}}]});var f=testnamespace.util.Util.C_CSV_NOTE_REQ_NOTE+" "+testnamespace.util.Util.getCurrentDateTime();e.saveFile(f).always(function(){this.destroy();});},exportChaRM:function(e,p){var m=e.getModel();var b=e.getBinding("items");var a=testnamespace.util.Util.getResourceBundle();var P="/SystemChangeRequestSet";if(p){P=p+P;}if(typeof b.sFilterParams!=="undefined"){P=P+"?"+b.sFilterParams;if(typeof b.sSortParams!=="undefined"){P=P+"&"+b.sSortParams;}}else{if(typeof b.sSortParams!=="undefined"){P=P+"?"+b.sSortParams;}}m.read(P,null,null,true,function(d){var c=new sap.ui.model.json.JSONModel();c.setData(d.results);var E=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:a.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:a.getText("CHARM_ID"),template:{content:"{ObjectId}"}},{name:a.getText("CHARM_SHORT_TEXT"),template:{content:"{ShortText}"}},{name:a.getText("CHARM_CREATEDBY"),template:{content:"{DisplayName}"}},{name:a.getText("CHARM_CREATEDAT"),template:{content:"{path: 'Createdat', formatter: 'testnamespace.util.Formatter.getDateTimeString'}"}}]});var f=testnamespace.util.Util.C_CSV_CHARM+" "+testnamespace.util.Util.getCurrentDateTime();E.setModel(c);E.bindRows("/");E.saveFile(f).always(function(){this.destroy();});});},exportBPCA:function(e,p){var m=e.getModel();var b=e.getBinding("items");var a=testnamespace.util.Util.getResourceBundle();var P="/SystemBPCASet";if(p){P=p+P;}if(typeof b.sFilterParams!=="undefined"){P=P+"?"+b.sFilterParams;if(typeof b.sSortParams!=="undefined"){P=P+"&"+b.sSortParams;}}else{if(typeof b.sSortParams!=="undefined"){P=P+"?"+b.sSortParams;}}m.read(P,null,null,true,function(d){var c=new sap.ui.model.json.JSONModel();c.setData(d.results);var E=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:a.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:a.getText("BPCA_ID"),template:{content:"{ResultId}"}},{name:a.getText("BPCA_SHORT_TEXT"),template:{content:"{ShortText}"}},{name:a.getText("BPCA_CREATEDBY"),template:{content:"{DisplayName}"}},{name:a.getText("BPCA_STARTEDDAT"),template:{content:"{path: 'Startedat', formatter: 'testnamespace.util.Formatter.getDateTimeString'}"}}]});var f=testnamespace.util.Util.C_CSV_BPCA+" "+testnamespace.util.Util.getCurrentDateTime();E.setModel(c);E.bindRows("/");E.saveFile(f).always(function(){this.destroy();});});},exportObjectList:function(m,p){var b=testnamespace.util.Util.getResourceBundle();var P="/SystemNoteObjectSet";if(p){P=p+P;}m.read(P,null,null,true,function(d){var a=new sap.ui.model.json.JSONModel();a.setData(d.results);var e=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:b.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:b.getText("NOTE_NUMBER"),template:{content:"{NoteNumber}"}},{name:b.getText("PROGRAM_ID"),template:{content:"{ProgramId}"}},{name:b.getText("OBJECT_TYPE"),template:{content:"{ObjectType}"}},{name:b.getText("OBJECT_NAME"),template:{content:"{ObjectName}"}},{name:b.getText("PROGRAM_ID2"),template:{content:"{ProgramId2}"}},{name:b.getText("OBJECT_TYPE2"),template:{content:"{ObjectType2}"}},{name:b.getText("OBJECT_NAME2"),template:{content:"{ObjectName2}"}}]});var f=testnamespace.util.Util.C_CSV_NOTE_OBJECT+" "+testnamespace.util.Util.getCurrentDateTime();e.setModel(a);e.bindRows("/");e.saveFile(f).always(function(){this.destroy();});});},exportRequiredNote:function(m,p){var b=testnamespace.util.Util.getResourceBundle();var P="/SystemNoteRequiredNoteSet";if(p){P=p+P;}m.read(P,null,null,true,function(d){var a=new sap.ui.model.json.JSONModel();a.setData(d.results);var e=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:b.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:b.getText("NOTE_NUMBER"),template:{content:"{NoteNumber}"}},{name:b.getText("NOTE_NUMBER_REQ"),template:{content:"{NoteNumberReq}"}},{name:b.getText("NOTE_TEXT"),template:{content:"{ShortText}"}}]});var f=testnamespace.util.Util.C_CSV_NOTE_REQ_NOTE+" "+testnamespace.util.Util.getCurrentDateTime();e.setModel(a);e.bindRows("/");e.saveFile(f).always(function(){this.destroy();});});},exportSystemNotes:function(e,p){var m=e.getModel();var b=e.getBinding("items");var a=testnamespace.util.Util.getResourceBundle();var P="/SystemNoteSet";if(p){P=p+P;}if(typeof b.sFilterParams!=="undefined"){P=P+"?"+b.sFilterParams;if(typeof b.sSortParams!=="undefined"){P=P+"&"+b.sSortParams;}}else{if(typeof b.sSortParams!=="undefined"){P=P+"?"+b.sSortParams;}}m.read(P,null,null,true,function(d){var c=new sap.ui.model.json.JSONModel();c.setData(d.results);var E=new sap.ui.core.util.Export({exportType:new sap.ui.core.util.ExportTypeCSV({}),columns:[{name:a.getText("TECHNICAL_SYSTEM"),template:{content:"{SystemId}"}},{name:a.getText("NOTE_NUMBER"),template:{content:"{NoteNumber}"}},{name:a.getText("NOTE_TEXT"),template:{content:"{ShortText}"}},{name:a.getText("NOTE_RELEASE_DATE"),template:{content:"{path: 'ReleaseDate', formatter: 'testnamespace.util.Formatter.getReleaseDate'}"}},{name:a.getText("NOTE_THEMK"),template:{content:"{Themk}"}},{name:a.getText("NOTE_PRIORITY"),template:{content:"{path: 'Priority', formatter: 'testnamespace.util.Formatter.getPriorityText'}"}},{name:a.getText("NOTE_CATEGORY"),template:{content:"{path: 'Category', formatter: 'testnamespace.util.Formatter.getCategoryText'}"}},{name:a.getText("NOTE_SEC_CATEGORY"),template:{content:"{path:'SecCategory', formatter: 'testnamespace.util.Formatter.getSecurityCategoryText'}"}},{name:a.getText("NOTE_STATUS"),template:{content:"{path: 'Status', formatter: 'testnamespace.util.Formatter.getStatusText'}"}},{name:a.getText("NOTE_CORRECTION_TYPES"),template:{content:"{path: 'CorrectionTypes', formatter: 'testnamespace.util.Formatter.getCorrectionText'}"}},{name:a.getText("NOTE_ATTRIBUTE"),template:{content:"{parts:[{path: 'HasKernel'},{path: 'IsIndep'}], formatter: 'testnamespace.util.Formatter.getAttributesText'}"}}]});var f=testnamespace.util.Util.C_CSV_SYSTEM_NOTE+" "+testnamespace.util.Util.getCurrentDateTime();E.setModel(c);E.bindRows("/");E.saveFile(f).always(function(){this.destroy();});});},displayMessage:function(r){jQuery.sap.require("sap.m.MessageBox");var b=testnamespace.util.Util.getResourceBundle();try{var j=JSON.parse(r.body);var m=j.error.message.value;var d=j.error.innererror.Error_Resolution.SAP_Transaction;sap.m.MessageBox.show(m,{icon:sap.m.MessageBox.Icon.ERROR,title:b.getText("MSG_ERROR"),details:d});}catch(e){var x=$.parseXML(r.body);var a=$(x);var c=a.find("message");sap.m.MessageBox.show(c.text(),{icon:sap.m.MessageBox.Icon.ERROR,title:b.getText("MSG_ERROR")});}},displayError:function(r){var j=JSON.parse(r);var m=j.error.message.value;var d=j.error.innererror.Error_Resolution.SAP_Transaction;jQuery.sap.require("sap.m.MessageBox");var b=testnamespace.util.Util.getResourceBundle();sap.m.MessageBox.show(m,{icon:sap.m.MessageBox.Icon.ERROR,title:b.getText("MSG_ERROR"),details:d});}};